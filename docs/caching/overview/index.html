<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apollo Client 한국어 문서 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apollo Client 한국어 문서 Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q748MW528E"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q748MW528E",{})</script><title data-react-helmet="true">캐시 개념잡기 | Apollo Client 한국어 문서</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.apollo-kr.site/docs/caching/overview"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="캐시 개념잡기 | Apollo Client 한국어 문서"><meta data-react-helmet="true" name="description" content="---"><meta data-react-helmet="true" property="og:description" content="---"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.apollo-kr.site/docs/caching/overview"><link data-react-helmet="true" rel="alternate" href="https://www.apollo-kr.site/docs/caching/overview" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.apollo-kr.site/docs/caching/overview" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ff7d4088.css">
<link rel="preload" href="/assets/js/runtime~main.748b3031.js" as="script">
<link rel="preload" href="/assets/js/main.1a53649c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apollo_logo.png" alt="Apollo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/apollo_logo.png" alt="Apollo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">아폴로 클라이언트 번역본</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">문서 보기</a><a class="navbar__item navbar__link" href="/blog">블로그</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hojunin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>개발자 : HojunIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Apollo Client 시작하기</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">아폴로가 뭔가요?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">데이터 주고받기(fetch)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">캐싱(cache)</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/caching/overview">캐시 개념잡기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/caching/configuration">캐시 설정하기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/caching/read_write">캐시에 읽고 쓰기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/caching/gc_and_eviction">가비지 컬랙션</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/caching/custom_cache">캐시 커스터마이징</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/caching/advanced">캐시를 더욱 똑똑하게 사용하기(Advanced)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">로컬 상태 관리(Local Satte)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">페이지네이션(pagination)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">네트워킹(networking)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">도움이 되는 도구들</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">성능 향상시키기(performance)</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Apollo에서 Cache란 무엇일까요?</h1></header><hr><p><a href="https://www.apollographql.com/docs/react/caching/overview/" target="_blank" rel="noopener noreferrer">Apollo Docs</a>를 번역 및 의역한 내용입니다.</p><hr><p>아주 간단하게 생각해서 Apollo Client가 데이터를 달라고 요청을 보내면 데이터를 가져올 수 있는 선택지는 두가지 밖에 없습니다. 첫번째는 Cache이고, 두번째는 Graphql Server입니다. 두 곳은 다음과 같은 특징이 있습니다.</p><ol><li>Cache : 매우 빠르다. 하지만 실제 데이터와 다를 수 있다. (동기화가 안되어있을 수 있다)</li><li>Graphql Server : 속도가 느리다. 서버를 다녀오는 부하도 있다. 하지만 실제 데이터를 직접 가져온다.</li></ol><p>그렇기 때문에 우리는 최대한 Cache를 활용해야 하고(성능을 위해), 실제 데이터와 다를 수 있는 부분을 생각하여 GraphQL Server를 다녀오는 횟수를 최소한으로 줄여야 합니다.</p><hr><p>Apollo Client는 Graphql 쿼리의 결과를 in-memory cache에 정규화된 형태로 저장합니다. 그래서 이미 캐쉬된 데이터를 읽어올 땐 서버에 다녀오지 않고도 즉각 읽어올 수 있는겁니다.</p><p>예를 들어서 id가 5인 Book 객체를 처음 호출했다고 가정해봅시다. Apollo client는 이 요청을 다음과 같은 흐름으로 처리할겁니다.</p><p><img alt="overview" src="/assets/images/cache_1-49f0fd3d3a0477862d73cb7bbb67795d.png"></p><p>Apollo Client는 id가 5인 Book 객체가 cache에 있는지 확인해봅니다. 첫 호출이니 당연히 없습니다. 그렇다면 GraphQL 서버로 가서 해당 데이터를 가져옵니다. 중간에 cache에 들러 해당 데이터를 cache에도 업데이트 해두고, 이 데이터를 Client에 돌려줍니다.</p><p>그리고 이 최초요청 이후에 똑같이 id가 5인 Book 객체를 호출한다면 위의 Flow와 다르게 다음과 같이 처리합니다.</p><p><img alt="overview" src="/assets/images/cache_2-3c841c5a056e87ecdd765875bbdec665.png"></p><p>Apollo Client는 id가 5인 Book 객체가 cache에 있는지 확인합니다. 아까 최초 요청때 서버에 다녀와서 캐싱해둔 데이터가 존재합니다. 그렇다면 서버를 다녀오지 않아도 됩니다. 그냥 캐시에 있는 데이터를 바로 리턴해줍니다.</p><hr><p>Apollo Client Cache는 굉장히 많은 옵션을 제공하고, 이에 따라 cache의 동작 방식을 커스터마이징 할 수 있습니다. Graphql 서버를 다녀오지 않고도 타입 하나하나, 필드 하나하나의 동작을 컨트롤 할 수 있고, 직접 캐시에 저장하거나 변경하는 기능도 제공합니다.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="cache에-데이터가-저장되는-방식">Cache에 데이터가 저장되는 방식<a aria-hidden="true" class="hash-link" href="#cache에-데이터가-저장되는-방식" title="Direct link to heading">​</a></h2><p>Apollo Client가 제공하는 <code>InMemoryCache</code>는 서로가 서로를 참조할 수 있는 flat lookup table형태로 유지됩니다.</p><p>flat lookup table : 간단히 말해, Deps가 1인 Object의 Array라고 이해하면 좋습니다 (Javascript의 .flat()함수를 생각해보세요)</p><p>이 객체들은 GraphQL 쿼리가 리턴하는 객체의 필드들을 재구성한 데이터들입니다. 예를 들어 만약에 여러 쿼리가 동일한 id의 객체를 수정하는 쿼리들이었다면 그 하나의 캐시된 데이터는 여러개의 쿼리가 리턴한 데이터들의 자잘한 수정값들을 모두 반영한 데이터일 수도 있습니다.</p><p>cache는 flat합니다. (flat하다는 것은 deps가 1이라는 뜻입니다) 하지만 gql이 리턴한 객체는 그렇지 않아요. 사실상 deps가 제멋대로입니다. 다음의 예시는 어떤 쿼리가 리턴한 결과값입니다.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;person&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;__typename&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Person&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cGVvcGxlOjE=&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Luke Skywalker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;homeworld&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;__typename&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Planet&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cGxhbmV0czox&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Tatooine&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>결과값을 간단히 살펴보면 data에는 <code>person</code> 객체를 담고 있습니다. 이 person 객체는 여러 필드를 리턴하지만 그 중 <code>homeworld</code> 필드가 <code>planet</code> 객체를 리턴합니다. 보시다시피 대부분의 JSON이 그러하듯 deps가 3인, 계층적 구조를 띄고 있습니다.</p><p>이런 계층적 데이터를 <code>InMemoryCache</code>는 어떻게 flat lookup table에 저장할까요? 정답은 정규화(normalize)에 있습니다.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="데이터-정규화">데이터 정규화<a aria-hidden="true" class="hash-link" href="#데이터-정규화" title="Direct link to heading">​</a></h3><p>Apollo client가 GQL이 리턴한 데이터를 받을 때 다음과 같은 과정을 거칩니다.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="1-객체-확인"><a href="https://www.apollographql.com/docs/react/caching/overview/#1-identify-objects" target="_blank" rel="noopener noreferrer">1.</a> 객체 확인<a aria-hidden="true" class="hash-link" href="#1-객체-확인" title="Direct link to heading">​</a></h3><p>가장 먼저 cache는 쿼리의 결과값에서 객체단위로 구분합니다. 바로 위의 예시를 다시 이용해보면, id가 <code>cGvvcGx10jE=</code>라는 <code>id</code>를 가진 <code>Person</code> 객체가 있었고, <code>cGxhbmV0czox</code>라는 <code>id</code>를 가진 <code>Planet</code> 객체가 있었죠. 캐시는 먼저 쿼리를 파싱해서 id로 어떤 Object들이 있는지 확인합니다.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="2-cache-id-발급하기"><a href="https://www.apollographql.com/docs/react/caching/overview/#2-generate-cache-ids" target="_blank" rel="noopener noreferrer">2.</a> cache id 발급하기<a aria-hidden="true" class="hash-link" href="#2-cache-id-발급하기" title="Direct link to heading">​</a></h3><p>cache는 이렇게 쿼리에서 객체들을 분류해낸 다음, 각각의 객체에게 cache ID라는 것을 발급합니다. cache ID는 <code>InMemoryCache</code>에서 각각의 객체에게 부여되는 고유ID입니다.</p><p>기본적으로 cache ID 생성규칙은 간단합니다. <!-- -->_<!-- -->_<!-- -->typename 필드의 값과 id를 콜론(:)으로 이어붙힌겁니다(<!-- -->_<!-- -->id도 가능)</p><p>위의 예시를 따르면 아래와 같은 cache ID를 발급받습니다.</p><ul><li><code>Person:cGVvcGxlOjE=</code></li><li><code>Planet:cGxhbmV0czox</code></li></ul><p>저희 서버의 데이터를 한번 보겠습니다.</p><p><img alt="overview" src="/assets/images/cache_3-243c53671a996718bc114d94faaa4f6f.png"></p><p>id: &quot;11&quot; , <!-- -->_<!-- -->_<!-- -->typename : &quot;User&quot;</p><p>사진의 상단에, 발급된 Cache ID를 보면 위에 설명된대로 발급되었다고 볼 수 있습니다.</p><blockquote><p>Cache ID를 커스터마이징 하실 수도 있지만, 딱히 문제가 없다면 그냥 쓰셔도 됩니다.</p></blockquote><p>만약에 cache가 <strong>typename 필드가 있는데도 해당 객체의 cache ID를 발급하지 않는다면 그 객체는 부모 객체에 직접 참조된 상태인 것입니다. 예를 들면 위 사진의 info 필드의 객체를 예로 들 수 있습니다. 실제로 확인해보면 아래와 같이 User 데이터만 cache되고, 엄연히 </strong>typename필드가 있는 UserInfo 객체는 cache되지 않은 것을 볼 수 있습니다.</p><p><img alt="overview" src="/assets/images/cache_4-49391d0089556092b6729ea478908ccf.png"></p><p>그래서 cache는 엄밀히 말하자면 100% flat한 구조는 아닌겁니다 (이에 대해선 왜 그런지 엄격하게 알아볼 필요가 있는데 아직 모르겠쓰으읍니다)</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="3-객체를-__ref값참조-객체-아이디로-변경하기"><a href="https://www.apollographql.com/docs/react/caching/overview/#3-replace-object-fields-with-references" target="_blank" rel="noopener noreferrer">3.</a> 객체를 <!-- -->_<!-- -->_<!-- -->ref값(참조 객체 아이디)로 변경하기<a aria-hidden="true" class="hash-link" href="#3-객체를-__ref값참조-객체-아이디로-변경하기" title="Direct link to heading">​</a></h3><p>3번째로, cache는 다른 타입이 아닌 객체를 담고 있던 field의 값을 객체가 아닌 참조 ID로 변경합니다.</p><p>예를 들어 위의 예시에서 <code>Person</code> 객체에서 <code>homeworld</code>필드는 <code>Planet</code>객체를 담고 있었습니다. 이 값을 cache된 Planet 객체의 cache ID를 담고 있는 <!-- -->_<!-- -->_<!-- -->ref라는 필드로 대체합니다. 아래 Before &amp; After를 확인해주세요.</p><ul><li>Before</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;__typename&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Person&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cGVvcGxlOjE=&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Luke Skywalker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;homeworld&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;__typename&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Planet&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cGxhbmV0czox&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Tatooine&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>After</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;__typename&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Person&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cGVvcGxlOjE=&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Luke Skywalker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;homeworld&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;__ref&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Planet:cGxhbmV0czox&quot;</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>이 변경과정은 이전 단계에서 cache ID생성에 실패한다면 진행되지 않습니다. 그 대신 그 객체가 그대로 남습니다.</p></blockquote><p>이후에 만약 똑같은 homeworld 필드를 가진 다른 Person객체가 호출되었을 때 정규화된 Person객체는 아까 생성된 Planet객체의 cache ID를 참조하고 있을 것이므로 두번 일하지 않게 되는것입니다. 또한 서버와 동기화 또한 자동으로 진행되겠지요.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="4-정규화된-객체-저장하기"><a href="https://www.apollographql.com/docs/react/caching/overview/#4-store-normalized-objects" target="_blank" rel="noopener noreferrer">4.</a> 정규화된 객체 저장하기<a aria-hidden="true" class="hash-link" href="#4-정규화된-객체-저장하기" title="Direct link to heading">​</a></h3><p>3번 과정에서 생성된 객체는 비로소 cache의 flat lookup table에 저장됩니다.</p><p>Apollo Client가 쿼리를 보냈을 때 Graphql 서버로부터 같은 cache ID를 가진 객체가 들어오면 해당 필드의 객체는 다음의 규칙을 참고하여 합쳐(merged)집니다.</p><ul><li>만약 서버에서 들어온 데이터와 이미 캐시에 존재하는 객체가 어떤 field를 공유한다면 서버의 데이터가 캐시의 데이터를 덮어씁니다(override)</li><li>만약 어떤 field들이 캐시된 데이터엔 없지만 서버에서 온 데이터에는 존재하는 경우, 혹은 캐시된 데이터엔 있는데 cache된 데이터엔 없다면 그 field는 건들지 않습니다(보존됩니다)</li></ul><hr><p>결론적으로 정규화 구조는 client의 변화에 능동적으로 대처할 수 있도록, 읽기에 최적화된 형태로 gql 데이터의 부분적인 복사본을 구축합니다.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="cached-data를-직접-확인하기">Cached Data를 직접 확인하기<a aria-hidden="true" class="hash-link" href="#cached-data를-직접-확인하기" title="Direct link to heading">​</a></h2><p>이 구조를 명확히 눈으로 보고 확인하려면 Apollo Dev Tools을 설치하시면 됩니다. 실제로 호출한 쿼리의 Object List가 좌측에, Normalize된 데이터가 우측에 나옵니다.</p><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="설치방법">설치방법<a aria-hidden="true" class="hash-link" href="#설치방법" title="Direct link to heading">​</a></h2><ol><li><a href="https://chrome.google.com/webstore/detail/apollo-client-devtools/jdkknkkbebbapilgoeccciglkfbmbnfm" target="_blank" rel="noopener noreferrer">이 링크</a>로 들어가서 구글 크롬 확장프로그램 설치.</li><li>Client를 실행하고 구글 디버거 켜기 (cmd+shift+j)</li><li>아래 그림처럼 우측 상단 Apollo 탭 누르기</li></ol><p><img src="https://www.apollographql.com/docs/react/22e1f98e0ea11849ee24813de8edeac2/cache-inspector.jpg" alt="https://www.apollographql.com/docs/react/22e1f98e0ea11849ee24813de8edeac2/cache-inspector.jpg"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/hojunin/apollo-client-docs/docs/caching/overview.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/fetcing/best_practice"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->좋은 예시(Best Practice)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/caching/configuration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">캐시 설정하기<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cache에-데이터가-저장되는-방식" class="table-of-contents__link toc-highlight">Cache에 데이터가 저장되는 방식</a><ul><li><a href="#데이터-정규화" class="table-of-contents__link toc-highlight">데이터 정규화</a></li><li><a href="#1-객체-확인" class="table-of-contents__link toc-highlight">1. 객체 확인</a></li><li><a href="#2-cache-id-발급하기" class="table-of-contents__link toc-highlight">2. cache id 발급하기</a></li><li><a href="#3-객체를-__ref값참조-객체-아이디로-변경하기" class="table-of-contents__link toc-highlight">3. 객체를 __ref값(참조 객체 아이디)로 변경하기</a></li><li><a href="#4-정규화된-객체-저장하기" class="table-of-contents__link toc-highlight">4. 정규화된 객체 저장하기</a></li></ul></li><li><a href="#cached-data를-직접-확인하기" class="table-of-contents__link toc-highlight">Cached Data를 직접 확인하기</a></li><li><a href="#설치방법" class="table-of-contents__link toc-highlight">설치방법</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">HOJUN IN</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/hojunin/apollo-client-docs/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">문의하기</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 HojunIn</div></div></div></footer></div>
<script src="/assets/js/runtime~main.748b3031.js"></script>
<script src="/assets/js/main.1a53649c.js"></script>
</body>
</html>