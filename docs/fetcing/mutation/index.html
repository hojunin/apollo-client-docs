<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apollo Client 한국어 문서 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apollo Client 한국어 문서 Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q748MW528E"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q748MW528E",{})</script><title data-react-helmet="true">뮤테이션(mutation) | Apollo Client 한국어 문서</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.apollo-kr.site/docs/fetcing/mutation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="뮤테이션(mutation) | Apollo Client 한국어 문서"><meta data-react-helmet="true" name="description" content="---"><meta data-react-helmet="true" property="og:description" content="---"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.apollo-kr.site/docs/fetcing/mutation"><link data-react-helmet="true" rel="alternate" href="https://www.apollo-kr.site/docs/fetcing/mutation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.apollo-kr.site/docs/fetcing/mutation" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ff7d4088.css">
<link rel="preload" href="/assets/js/runtime~main.748b3031.js" as="script">
<link rel="preload" href="/assets/js/main.1a53649c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apollo_logo.png" alt="Apollo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/apollo_logo.png" alt="Apollo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">아폴로 클라이언트 번역본</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">문서 보기</a><a class="navbar__item navbar__link" href="/blog">블로그</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hojunin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>개발자 : HojunIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Apollo Client 시작하기</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">아폴로가 뭔가요?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">데이터 주고받기(fetch)</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fetcing/query">쿼리(query)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/fetcing/mutation">뮤테이션(mutation)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fetcing/refetch">다시 조회하기(Refetch)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fetcing/subscription">구독(Subscription)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fetcing/fragment">프래그먼트(fragment)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fetcing/error_handling">에러 처리(Error Handling)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/fetcing/best_practice">좋은 예시(Best Practice)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">캐싱(cache)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">로컬 상태 관리(Local Satte)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">페이지네이션(pagination)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">네트워킹(networking)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">도움이 되는 도구들</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">성능 향상시키기(performance)</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>뮤테이션(mutation)</h1></header><hr><p><a href="https://www.apollographql.com/docs/react/data/mutations/" target="_blank" rel="noopener noreferrer">Apollo Docs</a>를 번역 및 의역한 내용입니다.</p><hr><p>이전 시간에 Apollo Client로 데이터를 fetch해오는 과정을 배웠습니다. 다음 단계는 뮤테이션으로 데이터를 업데이트 하는 법입니다. 이 글은 useMutation 훅을 graphQL 서버에 호출하는 법을 배울겁니다. 또한 뮤테이션을 날린 직후에 캐시에 업데이트하는 방법과 loading과 error값을 추적하는 방법까지 알아봅니다.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="뮤테이션-구성">뮤테이션 구성<a aria-hidden="true" class="hash-link" href="#뮤테이션-구성" title="Direct link to heading">​</a></h3><p>useMutation 리액트 훅은 Apollo 앱에서 mutation을 사용하기 위한 가장 기본적이면서 중요한 API입니다. mutation을 실행하기 위해 가장 먼저, useMutation을 리액트 컴포넌트 안에서 콜하고 mutation임을 알리는 graphQL string을 넘겨줘야합니다.컴포넌트가 렌더링될 때, useMutation은 일련의 값들을 리턴해줍니다.</p><ol><li><p>어디서든 콜할 수 있는 mutate 함수</p></li><li><p>여러 field가 들어있는 데이터 object(loading, error, data ...)</p></li></ol><p>그럼 예를 들어봅시다. 첫째로 <code>ADD_TODO</code>라는 graphQL mutation을 만들어봅니다. 간단히 to-do list에 할 일 하나를 추가하는 기능을 합니다. query document 형태로 변환시켜주는 gql 함수로 감싸는 것을 잊지 마세요.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">import </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> gql</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> useMutation </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> from &#x27;</span><span class="token directive function" style="color:#d73a49">@apollo</span><span class="token plain">/client&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const </span><span class="token constant" style="color:#36acaa">ADD_TODO</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gql`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">mutation</span><span class="token plain"> AddTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>다음으로, AddToDo라는 컴포넌트를 만듭니다. 입력받아서 제출하는 React 컴포넌트입니다. 여기 안에 아까 만든ADD_TODO를 넘겨줄겁니다.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">function AddTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">addTodo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> data </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> useMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">ADD_TODO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        onSubmit</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          e.preventDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          addTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">.value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">.value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;</span><span class="token keyword" style="color:#00009f">input</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ref</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;button </span><span class="token keyword" style="color:#00009f">type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;submit&quot;</span><span class="token plain">&gt;Add Todo&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="뮤테이션-함수-호출하기-calling-the-mutate-function">뮤테이션 함수 호출하기 (Calling the mutate function)<a aria-hidden="true" class="hash-link" href="#뮤테이션-함수-호출하기-calling-the-mutate-function" title="Direct link to heading">​</a></h3><p>useMutation 훅은 useQuery처럼 컴포넌트가 렌더링될 때 자동으로 실행되지 않습니다. 그 대신에 선언할 때 받은 mutate 함수(위에 코드에서 addToDo가 함수입니다) 를 리턴받아 사용합니다. 이 함수를 원하는 곳에서 원하는 때 콜하면 됩니다. 위 코드에서 보면 submit 버튼을 누를 때 콜하죠</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="옵션-추가하기-providing-option">옵션 추가하기 (Providing option)<a aria-hidden="true" class="hash-link" href="#옵션-추가하기-providing-option" title="Direct link to heading">​</a></h3><p>useMutation과 mutate 함수 둘 다 다음 링크에서 볼 수 있는 모든 option을 받을 수 있습니다.
다만 알아두셔야 할 점은, 어떤 옵션을 주던 mutate function은 useMutation에 종속되어 있기 때문에 만약 같은 옵션을 줬다면 useMutation에 준 옵션이 mutate function에 준 옵션을 덮어씁니다.
옵션위의 예시에서, addToDo 함수에 variables를 줬습니다.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="뮤테이션-상태-추적하기-tracking-mutation-status">뮤테이션 상태 추적하기 (Tracking mutation status)<a aria-hidden="true" class="hash-link" href="#뮤테이션-상태-추적하기-tracking-mutation-status" title="Direct link to heading">​</a></h3><p>뮤테이트 함수와 더불어 useMutation 훅은 뮤테이션의 현재 실행상태를 나타내는 객체를 리턴받습니다.
그 안에는 뮤테이트 함수가 호출되었는지 여부인 <strong>called</strong> , 뮤테이션 결과값이 오고 있는지의 여부인 <strong>loading</strong> 등이 포함됩니다.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="뮤테이션-후-캐시-업데이트-updating-the-cache-after-a-mutation">뮤테이션 후 캐시 업데이트 (Updating the cache after a mutation)<a aria-hidden="true" class="hash-link" href="#뮤테이션-후-캐시-업데이트-updating-the-cache-after-a-mutation" title="Direct link to heading">​</a></h3><p>뮤테이션을 실행하고나면 서버사이드 데이터가 변합니다. 만약 그 데이터가 캐시에 남아있다면 그 백엔드 데이터와 캐시를 동기화하기 위해 캐시 업데이트를 해야합니다.</p><ol><li>이미 존재하는 하나의 데이터를 업데이트 했을 때</li></ol><p>만약 뮤테이션이 이미 존재하는 데이터 하나를 업데이트 했을 때, 자동으로 뮤테이션이 값을 리턴할 때 캐시를 업데이트합니다. 그러기 위해서는 뮤테이션이 반드시 업데이트 된 데이터의 <strong>id</strong> 를 리턴해야합니다. 다행히도 아폴로의 모든 뮤테이션이 이걸 기본으로 합니다.</p><p>아래 todo list에서 이미 존재하는 아이템을 mutate하는 예시를 봅시다.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const </span><span class="token constant" style="color:#36acaa">UPDATE_TODO</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gql`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">mutation</span><span class="token plain"> UpdateTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updateTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function Todos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> loading</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> useQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">GET_TODOS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">updateTodo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> useMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">UPDATE_TODO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loading</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> return &lt;p&gt;Loading</span><span class="token operator" style="color:#393A34">...</span><span class="token plain">&lt;/p&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> return &lt;p&gt;</span><span class="token attr-name" style="color:#00a4db">Error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">&lt;/p&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return data.todos.map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;div key</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;p&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">type</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          onSubmit</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.preventDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            updateTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">.value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">.value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;</span><span class="token keyword" style="color:#00009f">input</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ref</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;button </span><span class="token keyword" style="color:#00009f">type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;submit&quot;</span><span class="token plain">&gt;Update Todo&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>이 컴포넌트에서 UPDATE_TODO 뮤테이트 함수를 실행시켰을 때, 뮤테이션은 업데이트 된 데이터의 id와 새롭게 변한 type까지 두 가지 데이터를 리턴합니다. 아폴로 클라이언트가 id로 데이터를 캐싱하기 때문에, 어떻게 자동으로 id에 맞는 데이터를 캐시에 업데이트하는지 알 수 있습니다. 이에 따라 앱의 UI도 자동으로 변하겠지요?</p><ol start="2"><li>entity가 여러개일 떄 (Making all other cache updates)</li></ol><p>만약 뮤테이션이 2개 이상의 엔티티를 변화시킨다거나 생성이나 삭제같은 작업을 할 때 캐시는 그 결과값을 자동으로 업데이트하지 않습니다. 이 문제를 해결하 위해 <strong>update</strong>함수를 useMutation에 옵션으로 끼워넣어야합니다.
update 함수의 목적은 뮤테이션을 통해 바뀐 서버 데이터를 캐시 데이터와 동기화하는 것입니다. 다음 예시를 보세요</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const </span><span class="token constant" style="color:#36acaa">GET_TODOS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gql`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">query</span><span class="token plain"> GetTodos </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    todos </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function AddTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">addTodo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> useMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">ADD_TODO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> addTodo </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cache.modify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          todos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existingTodos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            const newTodoRef </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cache.writeFragment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token attr-name" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> addTodo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token attr-name" style="color:#00a4db">fragment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gql`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">NewTodo</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Todo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              `</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">...</span><span class="token fragment function" style="color:#d73a49">existingTodos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newTodoRef</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        onSubmit</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          e.preventDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          addTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">.value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">.value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;</span><span class="token keyword" style="color:#00009f">input</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ref</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;button </span><span class="token keyword" style="color:#00009f">type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;submit&quot;</span><span class="token plain">&gt;Add Todo&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>코드를 보면, update 함수는 캐시 객체를 넘겨받고 <code>readQuery</code>나 <code>writeQuery</code>, <code>readFragment</code>, <code>writeFragment</code>, <code>modify</code>같은 캐시에 읽고 쓸 수 있는 Cache API를 사용할 수 있게 해줍니다.
이런 메소드들은 graphQL 서버와 통신하듯 cache를 직접 조작할 수 있게 해줍니다.</p><p>update function은 또한 data가 포함된 객체를 넘겨받습니다. 이걸 가지고 <code>cache.writeQuery</code>나 <code>cache.modify</code> 같은 메소드를 실행시키면 됩니다.</p><p>ADD_TODO 뮤테이션이 위 예제에서 실행될 때, 새롭게 추가되어 리턴 된 객체는 캐시에 저장됩니다. 하지만 GET_TODOS 쿼리가 받아온, 이전에 캐시에 저장되어 있던 todos는 자동으로 업데이트되지 않습니다. 이 말은 다시 말해 GET_TODOS 쿼리는 새롭게 추가된 todo 객체를 todo list에 반영할 수 없다는 것입니다.</p><p>이 문제를 해결하기 위해 cache.modify라는 메소드를 쓸껀데, 이 메소드는 강제로 캐시 데이터를 삭제하거나 추가합니다. 위 예시에서 GET_TODOS 쿼리의 결과값은 cache의 ROOT_QUERY.todos 배열에 저장됩니다. 그래서 우리는 todos modifier 함수를 사용해서 새롭게 추가된 배열로 캐시된 배열을 업데이트합니다. <code>cache.writeFragment</code> 메소드를 활용해서 우리는 새로 추가될 todo 아이템의 reference(id같은 것)를 얻을 수 있고 그걸 캐시의 ROOT_QUERY배열에 저장하는 것이죠.</p><p>위의 과정을 거쳐 변경된 캐시된 데이터들은 자동으로 broadcast합니다. 이 말은, 이 데이터를 기다리는 쿼리들이 listening하고 있다가 변경되는 즉시 그 데이터와 관련된 UI를 update한다는 뜻입니다. (Active Query들 중에 이 데이터를 가지고 있는 모든 캐시들에게 전파됩니다)</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="loading과-error-상태값-추적하기-tracking-loading-and-error-states">loading과 error 상태값 추적하기 (Tracking loading and error states)<a aria-hidden="true" class="hash-link" href="#loading과-error-상태값-추적하기-tracking-loading-and-error-states" title="Direct link to heading">​</a></h3><p>useMutation 훅에는 뮤테이트 함수의 loading과 error 상태값을 추적할 수 있는 매커니즘이 있습니다.
단일 엔티티를 업데이트하는 위의 예제를 다시한번 살펴볼까요?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">function Todos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">loading</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> queryLoading</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> queryError</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> useQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">GET_TODOS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updateTodo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">loading</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mutationLoading</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mutationError </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> useMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">UPDATE_TODO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queryLoading</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> return &lt;p&gt;Loading</span><span class="token operator" style="color:#393A34">...</span><span class="token plain">&lt;/p&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queryError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> return &lt;p&gt;</span><span class="token attr-name" style="color:#00a4db">Error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">&lt;/p&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return data.todos.map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;div key</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;p&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">type</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          onSubmit</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.preventDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            updateTodo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">.value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain">.value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;</span><span class="token keyword" style="color:#00009f">input</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ref</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">input</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;button </span><span class="token keyword" style="color:#00009f">type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;submit&quot;</span><span class="token plain">&gt;Update Todo&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">mutationLoading </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> &lt;p&gt;Loading</span><span class="token operator" style="color:#393A34">...</span><span class="token plain">&lt;/p&gt;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">mutationError </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> &lt;p&gt;</span><span class="token attr-name" style="color:#00a4db">Error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> Please try again&lt;/p&gt;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>위 코드에서 UI내에서 뮤테이션의 상태를 추적할 수 있는 loading과 error 값을 useMutation이 리턴해주는 result 객체에서 구조분해할 수 있습니다. 만약 콜백으로 사용하길 원하신다면 onComplete과 onError 옵션도 제공하니 사용하면 됩니다.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="usemutation-api">useMutation API<a aria-hidden="true" class="hash-link" href="#usemutation-api" title="Direct link to heading">​</a></h2><p>제공되는 옵션과 리턴되는 result 객체가 가진 field들을 설명하겠습니다.</p><p>useMutation을 콜할 때 대부분의 옵션들은 생략해도 좋습니다. 하지만 이런 옵션들도 있다는 사실을 알고 계시는게 좋습니다. <a href="https://www.apollographql.com/docs/react/api/react/hooks/" target="_blank" rel="noopener noreferrer">이 링크</a>에서 더 자세한 사용법을 공부하세요</p><table><thead><tr><th>옵션</th><th>타입</th><th>설명</th></tr></thead><tbody><tr><td>mutation</td><td>DocumentNode</td><td>graphql mutation document</td></tr><tr><td>variables</td><td>{<!-- -->[key:string]<!-- -->:any}</td><td>mutation이 실행되기 위해 필요한 모든 변수의 객체입니다.</td></tr><tr><td>update</td><td>(cache: DataProxy, mutationResult: FetchResult)</td><td>mutation이 발생하고 캐시를 업데이트하기 위해 사용되는 함수입니다.</td></tr><tr><td>ignoreResults</td><td>boolean</td><td>이 값이 true면 리턴되는 데이터는 mutation의 결과값으로 업데이트되지 않습니다.</td></tr><tr><td>optimisticResponse</td><td>object</td><td>서버로부터 result값이 오기 전에 mutation 결과값을 받는것이다. optimistic UI를 구현할 수 있게 합니다.</td></tr><tr><td>refetchQueries</td><td>Array&lt;string or { query: DocumentNode, variables?: TVariables}&gt; or ((mutationResult: FetchResult) =&gt; Array&lt;string or { query: DocumentNode, variables?: TVariables}&gt;)</td><td>mutation이 발생하고 어떤쿼리를 리페치할지 결정하는 함수로 이루어진 배열. 쿼리의 배열일 수도 있고 리페치될 쿼리들의 이름(Document)의 배열일수도 있습니다. variables를 안주면 가장 최근에 실행한 쿼리를 또 실행합니다.</td></tr><tr><td>awaitRefetchQueries</td><td>boolean</td><td>refetchQueries는 동기로 동작하는데 awaitRefetchQueries를 true로 주면 비동기로 동작하게 할 수 있습니다.</td></tr><tr><td>onComplete</td><td>(data: TData) =&gt; void</td><td>mutation이 성공적으로 실행되면 콜백 함수입니다.</td></tr><tr><td>onError</td><td>(error: ApolloError) =&gt; void</td><td>mutation이 실패하면 실행되는 콜백함수입니다.</td></tr><tr><td>context</td><td>Record&lt;string,any&gt;</td><td>컴포넌트와 네트워크 사이에서 공유되는 컨텍스트입니다.</td></tr><tr><td>client</td><td>ApolloClinet</td><td>ApolloClinet 인스턴스. 다른 클라이언트를 넣어줘야 하는 상황이 아니면 provider의 client를 씁니다.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_31ik" id="usemutation-response">useMutation Response<a aria-hidden="true" class="hash-link" href="#usemutation-response" title="Direct link to heading">​</a></h2><p>useMutation Response값은 배열 형태로 받을 수 있는데, mutate function이 첫번째로 오고 두번째로는 mutation의 결과값이 옵니다.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//(options?: MutationOptions) =&gt; Promise&lt;FetchResult&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mutateFunction</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> loading </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useMutation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">MUTATION_DOCS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">...</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>mutate</td><td>UI에서 mutation을 실행하는 함수. variables, refetchQueries같은 옵션을 넣을 수도 있다.</td><td>UI에서 mutation을 실행하는 함수. variables, refetchQueries같은 옵션을 넣을 수도 있다.</td></tr></tbody></table><p>다음은 결과(Result) 객체의 필드들입니다.</p><hr><table><thead><tr><th>값</th><th>타입</th><th>설명</th></tr></thead><tbody><tr><td>data</td><td>TData</td><td>mutation의 결과값. 만약 IgnoreResults값을 true로 줘버리면 이 data값이 undefined가 됩니다</td></tr><tr><td>loading</td><td>boolean</td><td>mutation의 현재 진행상태를 보여주는 boolean값입니다.</td></tr><tr><td>error</td><td>ApolloError</td><td>만약 mutation이 서버에 갔다가 실패하고 돌아오면 이유와 함께 에러를 뱉습니다.</td></tr><tr><td>called</td><td>boolean</td><td>mutation 함수가 실행될 때 true가 됩니다</td></tr><tr><td>client</td><td>ApolloClient</td><td>ApolloClient 인스턴스. client.writeData나 client.readQuery같은 캐시 메소드를 update function 외 지역에서 수행할 때 유용합니다.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_31ik" id="글을-마치며">글을 마치며<a aria-hidden="true" class="hash-link" href="#글을-마치며" title="Direct link to heading">​</a></h2><p>useQuery와 useMutation 훅은 graphQL을 원활하게 사용하기 위한 Apollo Clients의 핵심 API입니다. 이제 많이 익숙해졌을겁니다.
더 나아가 추후 포스팅될 고급 기능들까지도 사용해보셨으면 좋겠습니다.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/hojunin/apollo-client-docs/docs/fetcing/mutation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/fetcing/query"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->쿼리(query)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/fetcing/refetch"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">다시 조회하기(Refetch)<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#뮤테이션-구성" class="table-of-contents__link toc-highlight">뮤테이션 구성</a></li><li><a href="#뮤테이션-함수-호출하기-calling-the-mutate-function" class="table-of-contents__link toc-highlight">뮤테이션 함수 호출하기 (Calling the mutate function)</a></li><li><a href="#옵션-추가하기-providing-option" class="table-of-contents__link toc-highlight">옵션 추가하기 (Providing option)</a></li><li><a href="#뮤테이션-상태-추적하기-tracking-mutation-status" class="table-of-contents__link toc-highlight">뮤테이션 상태 추적하기 (Tracking mutation status)</a></li><li><a href="#뮤테이션-후-캐시-업데이트-updating-the-cache-after-a-mutation" class="table-of-contents__link toc-highlight">뮤테이션 후 캐시 업데이트 (Updating the cache after a mutation)</a></li><li><a href="#loading과-error-상태값-추적하기-tracking-loading-and-error-states" class="table-of-contents__link toc-highlight">loading과 error 상태값 추적하기 (Tracking loading and error states)</a></li><li><a href="#usemutation-api" class="table-of-contents__link toc-highlight">useMutation API</a></li><li><a href="#usemutation-response" class="table-of-contents__link toc-highlight">useMutation Response</a></li><li><a href="#글을-마치며" class="table-of-contents__link toc-highlight">글을 마치며</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">HOJUN IN</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/hojunin/apollo-client-docs/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">문의하기</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 HojunIn</div></div></div></footer></div>
<script src="/assets/js/runtime~main.748b3031.js"></script>
<script src="/assets/js/main.1a53649c.js"></script>
</body>
</html>