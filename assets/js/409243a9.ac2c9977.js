"use strict";(self.webpackChunkapollo_client=self.webpackChunkapollo_client||[]).push([[422],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return d}});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=o.createContext({}),c=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=c(e.components);return o.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},k=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,s=a(e,["components","mdxType","originalType","parentName"]),k=c(n),d=i,h=k["".concat(p,".").concat(d)]||k[d]||u[d]||r;return n?o.createElement(h,l(l({ref:t},s),{},{components:n})):o.createElement(h,l({ref:t},s))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=k;var a={};for(var p in t)hasOwnProperty.call(t,p)&&(a[p]=t[p]);a.originalType=e,a.mdxType="string"==typeof e?e:i,l[1]=a;for(var c=2;c<r;c++)l[c]=n[c];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}k.displayName="MDXCreateElement"},5348:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return a},contentTitle:function(){return p},metadata:function(){return c},toc:function(){return s},default:function(){return k}});var o=n(7462),i=n(3366),r=(n(7294),n(3905)),l=["components"],a={sidebar_position:4,title:"\uad6c\ub3c5(Subscription)"},p="\uad6c\ub3c5(Subscriptions)",c={unversionedId:"fetcing/subscription",id:"fetcing/subscription",isDocsHomePage:!1,title:"\uad6c\ub3c5(Subscription)",description:"---",source:"@site/docs/fetcing/subscription.md",sourceDirName:"fetcing",slug:"/fetcing/subscription",permalink:"/docs/fetcing/subscription",editUrl:"https://github.com/hojunin/apollo-client-docs/docs/fetcing/subscription.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"\uad6c\ub3c5(Subscription)"},sidebar:"tutorialSidebar",previous:{title:"\ub2e4\uc2dc \uc870\ud68c\ud558\uae30(Refetch)",permalink:"/docs/fetcing/refetch"},next:{title:"\ud504\ub798\uadf8\uba3c\ud2b8(fragment)",permalink:"/docs/fetcing/fragment"}},s=[{value:"\uc65c \uad73\uc774 Subscription\uc744 \uc0ac\uc6a9\ud574\uc57c\ud558\ub098\uc694?",id:"\uc65c-\uad73\uc774-subscription\uc744-\uc0ac\uc6a9\ud574\uc57c\ud558\ub098\uc694",children:[],level:2},{value:"Subsciprion \uc815\uc758\ud558\uae30",id:"subsciprion-\uc815\uc758\ud558\uae30",children:[{value:"\uc11c\ubc84 \ud30c\ud2b8",id:"\uc11c\ubc84-\ud30c\ud2b8",children:[],level:3},{value:"\ud074\ub77c\uc774\uc5b8\ud2b8 \ud30c\ud2b8",id:"\ud074\ub77c\uc774\uc5b8\ud2b8-\ud30c\ud2b8",children:[],level:3}],level:2},{value:"Subscription\uc744 \uc704\ud55c \uc900\ube44",id:"subscription\uc744-\uc704\ud55c-\uc900\ube44",children:[{value:"1.\ud544\uc694\ud55c \ud328\ud0a4\uc9c0\ub97c \uc124\uce58\ud569\ub2c8\ub2e4.",id:"1\ud544\uc694\ud55c-\ud328\ud0a4\uc9c0\ub97c-\uc124\uce58\ud569\ub2c8\ub2e4",children:[],level:3},{value:"2. WebSocketLink\ub97c \ucd08\uae30\ud654\ud569\ub2c8\ub2e4.",id:"2-websocketlink\ub97c-\ucd08\uae30\ud654\ud569\ub2c8\ub2e4",children:[],level:3},{value:"3. Split communication by operation (recommended)",id:"3-split-communication-by-operation-recommended",children:[],level:3},{value:"4. Provide the link chain to Apollo Client",id:"4-provide-the-link-chain-to-apollo-client",children:[],level:3},{value:"5. Authenticate over WebSocket (optional)",id:"5-authenticate-over-websocket-optional",children:[],level:3}],level:2}],u={toc:s};function k(e){var t=e.components,n=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\uad6c\ub3c5subscriptions"},"\uad6c\ub3c5(Subscriptions)"),(0,r.kt)("hr",null),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/react/data/subscriptions/"},"Apollo Docs"),"\ub97c \ubc88\uc5ed \ubc0f \uc758\uc5ed\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4."),(0,r.kt)("hr",null),(0,r.kt)("p",null,"GraphQL\uc740 ",(0,r.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/react/data/queries/"},"queries"),"\xa0and\xa0",(0,r.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/react/data/mutations/"},"mutations"),"\uc5d0 \uc774\uc5b4 3\ubc88\uc9f8\ub85c Subscription\uc774\ub77c\ub294 \uae30\ub2a5\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"query\ub098 mutation\ucc98\ub7fc subscription\ub3c4 graphql server\ub85c\ubd80\ud130 \ub370\uc774\ud130\ub97c \uac00\uc838\uc624\ub294(fetch) \uae30\ub2a5\uc744 \ud569\ub2c8\ub2e4. \ud558\uc9c0\ub9cc query\uc640\ub294 \ub2e4\ub974\uac8c subscription\uc740 \uc624\ub798 \uc9c0\uc18d\ub418\uba74\uc11c \ubcc0\ud654\ud558\ub294 \uacb0\uacfc\uac12\uc744 \uacc4\uc18d \ubcf4\ub0b4\uc90d\ub2c8\ub2e4. \ub300\ubd80\ubd84 \uc6f9\uc18c\ucf13\uc744 \uc0ac\uc6a9\ud558\uc5ec graphql \uc11c\ubc84\uc640 \uc5f0\uacb0\uc744 \uc720\uc9c0\ud558\uace0 \uc11c\ubc84\uac00 \ubcc0\uacbd\ub41c \uc0ac\ud56d\uc744 \ucd94\uc801\ud558\uc5ec \ud574\ub2f9 \uc0ac\ud56d\uc744 \ud074\ub77c\uc774\uc5b8\ud2b8\ub85c \uc3f4\uc90d\ub2c8\ub2e4(push)"),(0,r.kt)("p",null,"Subscription\uc740 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 \uc54c\ub9bc\uc744 \ubcf4\ub0b4\ub294 \uc791\uc5c5\uacfc \uac19\uc774 \uc2e4\uc2dc\uac04\uc73c\ub85c \ucc98\ub9ac\ud574\uc57c\ud558\ub294 \ubaa9\uc801\uc5d0 \ubd80\ud569\ud558\ub294 \ud0c0\uc785\uc758 \uc5f0\uc0b0\uc785\ub2c8\ub2e4"),(0,r.kt)("h2",{id:"\uc65c-\uad73\uc774-subscription\uc744-\uc0ac\uc6a9\ud574\uc57c\ud558\ub098\uc694"},"\uc65c \uad73\uc774 Subscription\uc744 \uc0ac\uc6a9\ud574\uc57c\ud558\ub098\uc694?"),(0,r.kt)("p",null,"\ub300\ubd80\ubd84\uc758 \uacbd\uc6b0 \ud074\ub77c\uc774\uc5b8\ud2b8\uac00 \ud56d\uc0c1 \ubaa8\ub4e0 \ub80c\ub354\ub9c1 \ub370\uc774\ud130\ub97c \uc11c\ubc84\uc5d0 \ub9de\ucdb0 \ucd5c\uc2e0 \ub370\uc774\ud130\ub85c \uc720\uc9c0\ud558\ub824\uace0 Subscription\uc744 \uc0ac\uc6a9\ud558\uc9c4 \uc54a\uc2b5\ub2c8\ub2e4. \uadf8\ub7ec\uace0 \uc2f6\uc73c\uba74 \uc77c\uc815 \uc8fc\uae30\ub9c8\ub2e4 \ucffc\ub9ac\ub97c \ub0a0\ub9ac\ub294 Polling\uc774\ub098 \ubc84\ud2bc \ud074\ub9ad\uacfc \uac19\uc740 \ud2b9\uc815 \ud2b8\ub9ac\uac70\uc5d0 \uacb0\ubd80\ud574 \ub2e4\uc2dc \ub370\uc774\ud130\ub97c \ucffc\ub9ac\ud558\ub294 refetching \ud568\uc218\ub97c \uc4f0\uc8e0."),(0,r.kt)("p",null,"\ud558\uc9c0\ub9cc \ub2e4\uc74c\uc758 \uacbd\uc6b0\uc5d4 Subscription\uc744 \uc368\uc57c\ud569\ub2c8\ub2e4."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ud070 \uac1d\uccb4\uc5d0\uc11c \uc791\uc740 \ubcc0\ud654\ub97c \uac10\uc9c0\ud560 \ub54c. \ud070 \ub370\uc774\ud130\uc5d0\uc11c \uc791\uc740 \ub370\uc774\ud130 \ubcc0\ud654\ub97c \uac10\uc9c0\ud558\ub824\uace0 1\ucd08\uc5d0 1\ud68c\uc529 \uc11c\ubc84\ub97c \ud638\ucd9c\ud55c\ub2e4\uace0 \uc0dd\uac01\ud574\ubcf4\uba74, \uac00\uc838\uc624\ub294 \uac1d\uccb4\uac00 \uac70\ub300\ud558\uae30 \ub54c\ubb38\uc5d0 \uc190\ud574\uc785\ub2c8\ub2e4. \ub300\uc2e0\uc5d0, \uc77c\ub2e8 \uac1d\uccb4\uc758 \ucd5c\ucd08 \uc0c1\ud0dc\ub97c \ucffc\ub9ac\ub85c \uac00\uc838\uc624\uace0 \ub098\uba38\uc9c0 \uc5c5\ub370\uc774\ud2b8 \uacfc\uc815\uc740 \uc11c\ubc84\uac00 \ubc14\ub010 field\ub9cc \ub0b4\ub824\ubcf4\ub0b4(push) \uc904\uac81\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ul"},"\ud638\ucd9c\uc2dc\uac04\uc774 \uc791\uace0 \uc2e4\uc2dc\uac04 \uc5c5\ub370\uc774\ud2b8\uac00 \ud544\uc694\ud55c \uc791\uc5c5\uc744 \ud560 \ub54c. \uc608\ub97c \ub4e4\uc5b4 \ucc44\ud305\uc774 \uc788\uaca0\uc2b5\ub2c8\ub2e4. \uc5c4\uccad\ub0d4 \ub7c9\uc758 \ub300\ud654 \ub370\uc774\ud130 \ub9ac\uc2a4\ud2b8 \uc911 \ud558\ub098\uac00 \uc0c8\ub85c \ucd94\uac00\ub41c\ub2e4\uace0 \uc0dd\uac01\ud574\ubd05\uc2dc\ub2e4. refetching\uc740 \uc560\ucd08\uc5d0 \ub370\uc774\ud130\uac00 \uc654\ub294\uc9c0\ub3c4 \ubaa8\ub974\ub2c8 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uace0, polling\uc740 \ub108\ubb34 \ubd80\ud558\uac00 \ud07d\ub2c8\ub2e4.")),(0,r.kt)("h2",{id:"subsciprion-\uc815\uc758\ud558\uae30"},"Subsciprion \uc815\uc758\ud558\uae30"),(0,r.kt)("p",null,"query\ub098 mutation\uacfc \ub9c8\ucc2c\uac00\uc9c0\ub85c Subscription\ub3c4 \uc815\uc758\ud560 \ub54c \uc11c\ubc84\uc640 \ud074\ub77c\uc774\uc5b8\ud2b8 \ub2e8 \ub458\ub2e4 \uc815\uc758\ud574\uc8fc\uc154\uc57c \ud569\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\uc11c\ubc84-\ud30c\ud2b8"},"\uc11c\ubc84 \ud30c\ud2b8"),(0,r.kt)("p",null,"Subscriptioin \ud560 \ub300\uc0c1\uc774 \ub418\ub294 \uc2a4\ud0a4\ub9c8\uc5d0 Subscription \ud0c0\uc785\uc73c\ub85c \uc815\uc758\ud574\uc90d\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc544\ub798 \ubcf4\uc774\ub294 \uc608\uc2dc\uc758 commentAdded\ub294 \uad6c\ub3c5\ud558\uace0 \uc788\ub294 client\uc5d0\uac8c \uc778\uc790\ub85c \ub123\uc5b4\uc900 postID\uc5d0 \ud574\ub2f9\ud558\ub294 \uae00\uc5d0 \uc0c8\ub85c\uc6b4 \ucf54\uba58\ud2b8\uac00 \uc0dd\uc131\ub418\uba74 \uc54c\ub9bc\uc744 \ubcf4\ub0b8\ub2e4\ub294 \ub73b\uc758 subscription \uc815\uc758\uc785\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"type Subscription {\n  commentAdded(postID: ID!): Comment\n}\n")),(0,r.kt)("p",null,"\uc11c\ubc84 \ucffc\ub9ac \uc815\uc758\uc5d0 \ub300\ud574 \uc774\ubcf4\ub2e4 \ub354 \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Apollo Server Docs\uc5d0 \uc124\uba85\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\ud074\ub77c\uc774\uc5b8\ud2b8-\ud30c\ud2b8"},"\ud074\ub77c\uc774\uc5b8\ud2b8 \ud30c\ud2b8"),(0,r.kt)("p",null,"\ud074\ub77c\uc774\uc5b8\ud2b8 \ub2e8\uc5d0\uc11c\ub294 \ucffc\ub9ac\ub97c \ub2e4\uc74c\uacfc \uac19\uc774 \uad6c\uc131\ud558\uc2dc\uba74 \ub429\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"const COMMENTS_SUBSCRIPTION = gql`\n  subscription OnCommentAdded($postID: ID!) {\n    commentAdded(postID: $postID) {\n      id\n      content\n    }\n  }\n`;\n")),(0,r.kt)("p",null,"Apollo Client\uac00 onCommentAdded\ub97c \uc2e4\ud589\ud558\uba74 GraphQL \uc11c\ubc84\uac00 \ub0b4\ub824\uc904 \ub370\uc774\ud130\ub97c \uc704\ud574 listening\uc744 \uc2dc\uc791\ud569\ub2c8\ub2e4. \ub2e4\ub9cc \ucffc\ub9ac\uc640 \ub2e4\ub974\uac8c \uc989\uac01 \ub370\uc774\ud130\ub97c \ub0b4\ub824\ubcf4\ub0b4\uc8fc\ub294 \uac74 \uc544\ub2c8\uace0, \uc11c\ubc84 \ub2e8\uc5d0\uc11c \ubb54\uac00 \ubcc0\ud654\uac00 \uc788\uc744 \ub54c \ubcf4\ub0b4\uc90d\ub2c8\ub2e4."),(0,r.kt)("p",null,"GQL \uc11c\ubc84\uac00 \ub370\uc774\ud130\ub97c \ubcf4\ub0b4\uae30(push) \uc2dc\uc791\ud558\uba74 \uadf8 \ub370\uc774\ud130\ub294 \uc544\ub798\uc640 \uac19\uc740 \uad6c\uc870\ub85c \ub0b4\ub824\ubc1b\uac8c\ub429\ub2c8\ub2e4. data \ud544\ub4dc \uc544\ub798subscription \uc774\ub984\uc774 \uc788\uace0, \uadf8 \uc544\ub798 \ubc1b\uae30\ub85c \ud588\ub358 field\ub4e4\uc774 \uc788\ub294 \uac83\uc785\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},'{\n  "data": {\n    "commentAdded": {\n      "id": "123",\n      "content": "What a thoughtful and well written post!"\n    }\n  }\n}\n')),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"subscription\uc744-\uc704\ud55c-\uc900\ube44"},(0,r.kt)("a",{parentName:"h2",href:"https://www.apollographql.com/docs/react/data/subscriptions/#setting-up-the-transport"},"Subscription"),"\uc744 \uc704\ud55c \uc900\ube44"),(0,r.kt)("p",null,"Subscription\uc774 \uc9c0\uc18d\uc801\uc73c\ub85c \uc11c\ubc84\uc640 \uc5f0\uacb0\uc744 \ud574\uc57c\ud558\ub294 \ud2b9\uc131 \ub54c\ubb38\uc5d0 query\ub098 mutation\uc744 \uc704\ud574 \uc0ac\uc6a9\ud588\ub358 \uae30\ubcf8 HTTP \ud1b5\uc2e0\uc744 \uc4f8 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uadf8 \ub300\uc2e0\uc5d0 Apollo Client Subscription\uc740 \uac00\uc7a5 \uc798 \uc54c\ub824\uc9c4 \uc2e4\uc2dc\uac04 \ud1b5\uc2e0 \ubc29\uc2dd\uc778 WebSocket\uc744 \uc4f0\uaca0\uc2b5\ub2c8\ub2e4(",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apollographql/subscriptions-transport-ws"},"subscriptions-transport-ws"),")"),(0,r.kt)("h3",{id:"1\ud544\uc694\ud55c-\ud328\ud0a4\uc9c0\ub97c-\uc124\uce58\ud569\ub2c8\ub2e4"},"1.\ud544\uc694\ud55c \ud328\ud0a4\uc9c0\ub97c \uc124\uce58\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/react/api/link/introduction/"},"Apollo Link"),"\xa0\ub294 Apollo Client\uc758 \ub124\ud2b8\uc6cc\ud06c \uad00\ub9ac\ub97c \ub3c4\uc640\uc8fc\ub294 \ub77c\uc774\ube0c\ub7ec\ub9ac\uc785\ub2c8\ub2e4. \uad8c\uace0\uc0ac\ud56d\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"WebSocket\uc73c\ub85c Subscription\uc744 \uc774\uc6a9\ud558\ub824\uba74 \uc6b0\ub9ac link chain\uc5d0 WebSoketLink\ub97c \ucd94\uac00\ud574\uc57c\ud569\ub2c8\ub2e4. \uc774 \ub9c1\ud06c\ub294 subscription-transport-ws \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \ud544\uc694\ub85c\ud569\ub2c8\ub2e4. \uadf8\ub7ec\ubbc0\ub85c \uc774\uac78 \uc124\uce58\ud569\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install subscriptions-transport-ws\n")),(0,r.kt)("h3",{id:"2-websocketlink\ub97c-\ucd08\uae30\ud654\ud569\ub2c8\ub2e4"},"2. WebSocketLink\ub97c \ucd08\uae30\ud654\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"ApolloClient\ub97c \uc0dd\uc131\ud588\ub358 \ud30c\uc77c(index.js)\uc5d0 WebSocketLink \uac1d\uccb4\ub97c \uc0dd\uc131\ud558\uace0 \ucd08\uae30\ud654\ud569\ub2c8\ub2e4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"//index.js\nimport { WebSocketLink } from '@apollo/client/link/ws';\n\nconst wsLink = new WebSocketLink({\n    uri: 'ws://localhost:4000/subscriptions',\n    options: {\n        reconnect: true,\n    },\n});\n")),(0,r.kt)("p",null,"\uc5ec\uae30\uc11c ApolloClient \uac1d\uccb4\uc758 uri\uc640 \ub2e4\ub978\uc810\uc740 GraphQL\uc11c\ubc84\uc758 ws://\ub85c \uc2dc\uc791\ud558\ub294 subscription \uc804\uc6a9 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ub123\uc5b4\uc8fc\uc154\uc57c \ud55c\ub2e4\ub294 \uc810\uc785\ub2c8\ub2e4. Apollo Server\ub97c \uc0ac\uc6a9\uc911\uc774\ub77c\uba74 \uc774 ",(0,r.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/apollo-server/data/subscriptions/#setting-a-subscription-endpoint"},"\ub3c5\uc2a4"),"\ub97c \ucc38\uace0\ud574\uc8fc\uc138\uc694"),(0,r.kt)("h3",{id:"3-split-communication-by-operation-recommended"},"3. Split communication by operation (recommended)"),(0,r.kt)("p",null,"Although Apollo Client\xa0",(0,r.kt)("em",{parentName:"p"},"can"),"\xa0use your\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"WebSocketLink"),"\xa0to execute all operation types, in most cases it should continue using HTTP for queries and mutations. This is because queries and mutations don't require a stateful or long-lasting connection, making HTTP more efficient and scalable if a WebSocket connection isn't already present."),(0,r.kt)("p",null,"To support this, the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"@apollo/client"),"\xa0library provides a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"split"),"\xa0function that lets you use one of two different\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Link"),"s, according to the result of a boolean check."),(0,r.kt)("p",null,"The following example expands on the previous one by initializing both a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"WebSocketLink"),"\xa0",(0,r.kt)("em",{parentName:"p"},"and"),"\xa0an\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"HttpLink"),". It then uses the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"split"),"\xa0function to combine those two\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Link"),"s into a\xa0",(0,r.kt)("em",{parentName:"p"},"single"),"\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Link"),"\xa0that uses one or the other according to the type of operation being executed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { split, HttpLink } from '@apollo/client';\nimport { getMainDefinition } from '@apollo/client/utilities';\nimport { WebSocketLink } from '@apollo/client/link/ws';\n\nconst httpLink = new HttpLink({\n    uri: 'http://localhost:4000/graphql',\n});\n\nconst wsLink = new WebSocketLink({\n    uri: 'ws://localhost:4000/subscriptions',\n    options: {\n        reconnect: true,\n    },\n});\n\n// The split function takes three parameters:\n//\n// * A function that's called for each operation to execute\n// * The Link to use for an operation if the function returns a \"truthy\" value\n// * The Link to use for an operation if the function returns a \"falsy\" value\nconst splitLink = split(\n    ({ query }) => {\n        const definition = getMainDefinition(query);\n        return definition.kind === 'OperationDefinition' && definition.operation === 'subscription';\n    },\n    wsLink,\n    httpLink,\n);\n")),(0,r.kt)("p",null,"Using this logic, queries and mutations will use HTTP as normal, and subscriptions will use WebSocket."),(0,r.kt)("h3",{id:"4-provide-the-link-chain-to-apollo-client"},(0,r.kt)("a",{parentName:"h3",href:"https://www.apollographql.com/docs/react/data/subscriptions/#4-provide-the-link-chain-to-apollo-client"},"4. Provide the link chain to Apollo Client")),(0,r.kt)("p",null,"After you define your link chain, you provide it to Apollo Client via the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"link"),"\xa0constructor option:"),(0,r.kt)("p",null,"index.js"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Copy")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { ApolloClient, InMemoryCache } from '@apollo/client';\n\n// ...code from the above example goes here...\n\nconst client = new ApolloClient({\n    link: splitLink,\n    cache: new InMemoryCache(),\n});\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you provide the\xa0link\xa0option, it takes precedence over the\xa0uri\xa0option (uri\xa0sets up a default HTTP link chain using the provided URL).")),(0,r.kt)("h3",{id:"5-authenticate-over-websocket-optional"},(0,r.kt)("a",{parentName:"h3",href:"https://www.apollographql.com/docs/react/data/subscriptions/#5-authenticate-over-websocket-optional"},"5. Authenticate over WebSocket (optional)")),(0,r.kt)("p",null,"It is often necessary to authenticate a client before allowing it to receive subscription results. To do this, you can provide a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"connectionParams"),"\xa0option to the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"WebSocketLink"),"\xa0constructor, like so:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Copy")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { WebSocketLink } from '@apollo/client/link/ws';\n\nconst wsLink = new WebSocketLink({\n    uri: 'ws://localhost:4000/subscriptions',\n    options: {\n        reconnect: true,\n        connectionParams: { authToken: user.authToken },\n    },\n});\n")),(0,r.kt)("p",null,"Your\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"WebSocketLink"),"\xa0passes the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"connectionParams"),"\xa0object to your server whenever it connects. If your server has a\xa0",(0,r.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/graphql-subscriptions/authentication"},"SubscriptionsServer"),"\xa0object that's listening for WebSocket connections, it receives the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"connectionParams"),"\xa0object and can use it to perform authentication, along with any other connection-related tasks."))}k.isMDXComponent=!0}}]);